---
title: "Actuarial Firms"
output: html_document
date: "2023-07-20"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(stringr)
library(ggplot2)
options(scipen = 999)
```

```{r}
data <- rio::import("Actuarial Firm Summary.xlsx", sheet = 2) %>% 
  mutate(AAL_percent = round(AAL_percent*100, 1),
         AAL_billion = round(AAL/1000000000),
         AAL_billion = paste0("$", AAL_billion, "B")) 

  mutate(AAL = prettyNum(AAL, big.mark = ","),
         UAL = prettyNum(UAL, big.mark = ","))

  
```
```{r}
data
```


```{r}
data %>% 
  ggplot(aes(fct_reorder(actuarial_firm_name, AAL), AAL)) +
  geom_col(fill = "#FF6632") +
  geom_text(aes(label = AAL_billion), color = "black", size = 2, 
            nudge_y = -30000000000) +
  coord_flip() +
  labs(x = "") +
  scale_y_continuous(breaks = c(500000000000, 1000000000000, 1490000000000),
                   label = c("$500B","$1T","$1.5T")) +
  theme(plot.margin = margin(2, 8, 6, 2, "pt")) +
  theme_minimal() 
  
```
```{r}
data
```




## Clean names
```{r}
firm_name <- rio::import("data/actuarial_firm_name.csv") %>% distinct()
  #clean
    mutate(acturial_firm_name = str_to_title(acturial_firm_name),
         acturial_firm_name = str_squish(acturial_firm_name)) %>% 
  
  #harmonize names
  mutate(acturial_firm_name_new = 
           case_when(str_detect(acturial_firm_name, "(i?)Gabriel|Grs") ~ 
                       "Gabriel, Roeder, Smith & Company (GRS)", 
                     
                    str_detect(acturial_firm_name, "(i?)Cavan") ~ 
                      "Cavanaugh Macdonald Consulting",
                    
                    str_detect(acturial_firm_name, "(i?)Segal") ~
                    "Segal Consulting",
                    
                    str_detect(acturial_firm_name, "(i?)California") ~
                    "California Public Employeesâ€™ Retirement System - Actuarial Office",
                    
                    
                    str_detect(acturial_firm_name, "(i?)Buck|Xerox|Conduent") ~ 
                      "Conduent (formerly Buck and/or Xerox)",
                    
                    str_detect(acturial_firm_name, "(i?)Che") ~
                    "Cheiron",
                    str_detect(acturial_firm_name, "(i?)Foster") ~
                    "Foster & Foster, Actuaries and Consultants",
                    
                    str_detect(acturial_firm_name, "(i?)Bartel") ~
                    "Bartel Associates",
                    str_detect(acturial_firm_name, "(i?)Milliman") ~
                    "Milliman",
                    
                    str_detect(acturial_firm_name, "(i?)Block") ~
                    "Block Consulting Actuaries",
                    str_detect(acturial_firm_name, "(i?)Bolton") ~
                    "Bolton Partners",
                    
                    str_detect(acturial_firm_name, "(i?)Curran") ~
                    "G.S.Curran & Company",
                    
                    str_detect(acturial_firm_name, "(i?)Korn") ~
                    "Korn Ferry Hay Group",
                    str_detect(acturial_firm_name, "(i?)Internal") ~
                    "Internal Actuarial Services",
                    str_detect(acturial_firm_name, "(i?)Osborn") ~
                    "Osborn, Carreiro & Associates",
                                        TRUE ~ acturial_firm_name)) 
```

